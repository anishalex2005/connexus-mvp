#!/bin/sh
# Pre-commit hook for Flutter project

echo "Running pre-commit checks..."

# Skip if Flutter is not installed
if ! command -v flutter >/dev/null 2>&1; then
  echo "Flutter not found; skipping format/analyze checks."
  exit 0
fi

# Dart format check (Flutter no longer provides `flutter format`)
echo "Checking dart format..."
if command -v dart >/dev/null 2>&1; then
  dart format --set-exit-if-changed lib test
  if [ $? -ne 0 ]; then
      echo "❌ Dart format check failed. Please run 'dart format lib test'"
      exit 1
  fi
else
  echo "Dart CLI not found; skipping format check."
fi

# Flutter analyze (limit to Flutter app package to avoid root-only test files)
echo "Running flutter analyze..."
flutter analyze connexus_app
if [ $? -ne 0 ]; then
    echo "❌ Flutter analyze failed. Please fix the issues above."
    exit 1
fi

# Run tests (optional - can be slow)
# echo "Running tests..."
# flutter test
# if [ $? -ne 0 ]; then
#     echo "❌ Tests failed. Please fix failing tests."
#     exit 1
# fi

echo "✅ All pre-commit checks passed!"


